#!/usr/bin/env BQN
# Takes the size of grid (1 side) and the size of the starting pile as command line arguments
sizeâ€¿pileâ†â€¢BQNÂ¨ 2â†‘â€¢args
_Fpâ†{ğ”½âˆ˜âŠ¢âŸâ‰¢âŸœğ”½_ğ•£âˆ˜âŠ¢âŸâ‰¢âŸœğ”½ğ•©} # Fixed point function
Sandâ†{pâ†ğ•©â‰¥4 â‹„ (ğ•©+Â¯4Ã—p)++Â´âŸ¨Â«,Â»,Â«Ë˜,Â»Ë˜âŸ©{ğ•ğ•©}Â¨<p}_Fp # Calculates given sand grid until it stops changing

lastâ†Sand pileË™âŒ¾((â‹ˆËœâŒŠsizeÃ·2)âŠ¸âŠ‘) sizeâ€¿sizeâ¥Š0 # Calculate the last state of the sand grid

# PPM output, code taken from https://rosettacode.org/wiki/Bitmap/Write_a_PPM_file#BQN
header_ppmâ†"P6"âˆ¾(@+10)âˆ¾(â€¢Repr size)âˆ¾" "âˆ¾(â€¢Repr size)âˆ¾(@+10)âˆ¾"255"âˆ¾@+10
colorsâ†4âŠ¸â†‘âŒ¾âŒ½255Ã—=âŒœËœâ†•3 # Black, Red, Green, Blue
image_ppmâ†@+â¥ŠcolorsâŠËœ4|last
"sandpile.ppm" â€¢file.Bytes header_ppmâˆ¾image_ppm
