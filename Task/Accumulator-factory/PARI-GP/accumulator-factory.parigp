stack = List([1]);
factory(b,c=0) = my(a=stack[1]++);listput(stack,c);(b)->stack[a]+=b;

foo(f) = factory(0, f);     \\ initialize the factory
