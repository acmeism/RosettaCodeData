step(M)={
  my(N=M,W=matsize(M)[1],L=#M,t);
  for(l=1,W,for(w=1,L,
    t=sum(i=l-1,l+1,sum(j=w-1,w+1,if(i<1||j<1||i>W||j>L,0,M[i,j])));
    N[l,w]=(t==3||(M[l,w]&&t==4))
  ));
  N
};
M=[0,1,0;0,1,0;0,1,0];
for(i=1,3,print(M);M=step(M))
