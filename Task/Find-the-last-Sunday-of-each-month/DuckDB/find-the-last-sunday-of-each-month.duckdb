create or replace function last_sunday(yr, mo) as  (
  select dy
  from (select unnest(range(
          extract('day' from last_day(make_date(yr,mo,1))), 1, -1)) as dy )
  where extract('dayofweek' from make_date(yr, mo, dy )) = 0 -- Sunday
  limit 1
);

create or replace function last_sundays(yr) as table  (
  select yr as yr, mo, last_sunday(yr, mo) as dy
  from range(1,13) u(mo)
);

from last_sundays(2013);
