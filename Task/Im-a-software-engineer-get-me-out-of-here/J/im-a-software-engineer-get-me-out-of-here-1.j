map=: <:,"_1 {.@>:@".@>>cutLF{{)n
         00000
      00003130000
    000321322221000
   00231222432132200
  0041433223233211100
  0232231612142618530
 003152122326114121200
 031252235216111132210
 022211246332311115210
00113232262121317213200
03152118212313211411110
03231234121132221411410
03513213411311414112320
00427534125412213211400
 013322444412122123210
 015132331312411123120
 003333612214233913300
  0219126511415312570
  0021321524341325100
   00211415413523200
    000122111322000
      00001120000
         00000
}}

adjacent=: 0 0-.~>,{;~i:1

plan=: {{
  loc=. {:y
  range=. (<loc){map
  next=. (loc+"1/range*adjacent)-.y
  next=. next #~ */"1]0 <: next
  next=. next #~ */"1]($map) >"1 next
  next=. next #~ 0 <: (<"1 next) { map
  assert. 2={:$next
  y,"2 1 next
}}

dijkpaths=: {{
  K=: 0
  adjacent=: 0 0-.~>,{;~i:1 NB. horizontal, diagonal, vertical
  plans=: ,:,:y NB. list of paths
  while. -.0 e. distances=: (<@{:"2 plans){map do.
    plans=: ; <@plan"_1 plans
  end.
  (0=distances)#plans
}}

fmtpaths=: {{ rplc&'j,'"1":j./"1 y }}
