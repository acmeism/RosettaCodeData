kaprekarp(n) := block(
   [p, q, a, b],
   if n = 1 then true else (
      q: n * n,
      p: 10,
      catch(
         while p < q do (
            [a, b]: divide(q, p),
            if b > 0 and a + b = n then throw(true),
            p: 10 * p
         ),
         false
      )
   )
)$

sublist(makelist(i, i, 1, 10^6), kaprekarp);
[1, 9, 45, 55, 99, 297, 703, 999, 2223, 2728, 4879, 4950, 5050, 5292, 7272, 7777, 9999,
17344, 22222, 38962, 77778, 82656, 95121, 99999, 142857, 148149, 181819, 187110, 208495,
318682, 329967, 351352, 356643, 390313, 461539, 466830, 499500, 500500, 533170, 538461,
609687, 627615, 643357, 648648, 670033, 681318, 791505, 812890, 818181, 851851, 857143,
961038, 994708, 999999]

length(%);
54
