func is_mersenne_prime(p) {
    p == 2 && return true
    var s = 4
    var mp = (2**p - 1)
    {
      s = expmod(s, 2, mp)-2
      s < 0 && (s += mp)
    } * (p-2)
    s == 0
}

Inf.times { |n|
    if (n.is_prime && is_mersenne_prime(n)) {
        say "M#{n}"
    }
}
