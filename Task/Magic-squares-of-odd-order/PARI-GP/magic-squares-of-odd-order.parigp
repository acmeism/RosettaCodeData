magicSquare(n)={
  my(M=matrix(n,n),j=n\2+1,i=1);
  for(l=1,n^2,
    M[i,j]=l;
    if(M[(i-2)%n+1,j%n+1],
      i=i%n+1
    ,
      i=(i-2)%n+1;
      j=j%n+1
    )
  );
  M;
}
magicSquare(7)
