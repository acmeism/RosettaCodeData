_modMul â† { n _ğ•£: n|Ã— }
MillerRabin â† {  ğ•Šn: 10ğ•Šn ; iter ğ•Š n: !2|n
  # n = 1 + dÃ—2â‹†s
  s â† 0 {ğ•¨ 2âŠ¸|â—¶âŸ¨+âŸœ1ğ•Š2âŒŠâˆ˜Ã·ËœâŠ¢,âŠ£âŸ© ğ•©} n-1
  d â† (n-1) Ã· 2â‹†s

  # Arithmetic mod n
  Mul â† n _modMul
  Pow â† Mul{ğ”½Â´ğ”½ËœâŸ(/2|âŒŠâˆ˜Ã·âŸœ2âŸ(â†•1+Â·âŒŠ2â‹†â¼âŠ¢)ğ•©)ğ•¨}

  # Miller-Rabin test
  MR â† {
       1 =ğ•© ? ğ•¨â‰ s ;
    (n-1)=ğ•© ? 0   ;
        ğ•¨â‰¤1 ? 1   ;
    (ğ•¨-1) ğ•Š MulËœğ•©
  }
  C â† { ğ•Ša: s MR a Pow d }  # Is composite
  {0:1; C â€¢rand.RangeâŒ¾(-âŸœ2) n ? 0; ğ•Šğ•©-1} iter
}
