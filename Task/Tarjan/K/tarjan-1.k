F:{[g]
  r::s::!i::0
  t::+`o`j`k!(#g)#'0,2##g
  L::{[g;v]
    t[v]:1,i,i; s,:v; i+:1
    {[g;v;w]
      $[t[`k;w]=#g; L w; ~t[`o;w]; :0N]
      t[`j;v]&:t[`j;w]}[g;v]'g v
    $[=/t[`j`k;v]
      [a:*&v=s; c:a_s; t[`o;c]:0; s::a#s; r,:,c]
     ]}[g]
  {[g;v] $[t[`k;v]=#g; L v; ]}[g]'!#g
  r}
