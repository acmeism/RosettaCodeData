# j is a JSON object ; return a list of the keys for which the value is less than 1
create or replace function report(j) as (
  list_filter(json_keys(j), k ->  (j -> k) < 1 )
);

select count(*) from
from (select report(struct_pack(*COLUMNS('flag'))::JSON) as flags
      from t
      where flags = []);
