create or replace table EMP as
  from read_csv_auto('input.csv');

create or replace function rank_by_department(number) as table (
  with cte as (
    SELECT *, row_number() OVER (PARTITION BY Department ORDER BY salary desc) as rank
    FROM EMP
  )
  select * from cte
  where rank <= number
  order by Department, Salary DESC
);

from rank_by_department(3);
